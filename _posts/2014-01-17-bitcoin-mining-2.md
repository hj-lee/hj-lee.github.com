---
layout: post
title: "비트코인(Bitcoin) 지갑(Wallet)과 채굴(mining) - 기술적 내용 보충"
description: ""
category: 
tags: []
date: 2014-02-12
published: true
---
{% include JB/setup %}

[wiki]: https://en.bitcoin.it/wiki/Main_Page
[wiki-address]: https://en.bitcoin.it/wiki/Address

[wiki-address-tech]: https://en.bitcoin.it/wiki/Technical_background_of_Bitcoin_addresses

[wiki-dificulty]: https://en.bitcoin.it/wiki/Difficulty

[wiki-block-hashing]: https://en.bitcoin.it/wiki/Block_hashing_algorithm

[wiki-block]: https://en.bitcoin.it/wiki/Blocks

[wiki-hashcash]: https://en.bitcoin.it/wiki/Hashcash

[public-key-crypto]: http://ko.wikipedia.org/wiki/%EA%B3%B5%EA%B0%9C_%ED%82%A4_%EC%95%94%ED%98%B8_%EB%B0%A9%EC%8B%9D

[crypto-hash]:http://ko.wikipedia.org/wiki/%EC%95%94%ED%98%B8%ED%99%94_%ED%95%B4%EC%8B%9C_%ED%95%A8%EC%88%98

[prev]: {% post_url 2014-01-18-bitcoin-mining %}

이전 [비트코인(Bitcoin) 채굴(mining)로 돈을 벌 수 있을까?][prev] 에서 비트코인 주소와 인정(Confirmation)에 대해서 자세한 설명을 생략했었는데, 이 글에서는 이 두가지를 좀 더 자세하게 설명해 보려고 합니다.

사실 비트코인이 무엇인지, 비트코인 지갑이 무엇인지, 채굴이 무엇인지 등을 소개하고 설명하는 내용은 웹상에 널려 있습니다.

영어를 읽는데 무리가 없으시다면 [비트코인 위키 문서][wiki]에 더 자세하고 세분화된 설명이 있습니다.

### 비트코인 주소(Address)

비트코인 주소에 대해서는 다음의 두 비트코인 위키 문서를 주로 참고하였습니다.

* [Address][wiki-address]
* [Technical background of version 1 Bitcoin addresses][wiki-address-tech]

비트코인 주소는 27~34개의 영숫자로 이루어지고 1 혹은 3으로 시작합니다. 지갑 소프트웨어를 사용하면 새 주소를 쉽게 만들 수 있습니다. 다른 사람에게 비트코인을 보내고 싶으면 그 사람의 비트코인 주소로 비트코인을 보내면 됩니다. 비트코인 주소는 한 사람이 여러개를 가질 수 있는데, 그렇지 않고서는 어떤 목적에서, 혹은 어떤 사람으로 부터 받은 것인지 구분하기가 어렵기 때문에 매 "거래(Transaction)"마다 새로운 주소를 사용할 것을 권장하기도 합니다.
실제로 비트코인으로 결재 가능한 전자상거래 사이트들의 경우에는 비트코인으로 결재 할 때마다 새로운 주소가 주어지는 것이 일반적입니다.

비트코인 주소는 [공개키 암호 방식][public-key-crypto]을 기반으로 하고 있습니다. 지갑 소프트웨어가 비트코인 주소를 만들 때는 공개키(Public Key)와 개인키(Private Key)가 쌍으로 만들어 지게됩니다. 여기서 공개키가 비트코인을 받을 주소가 되고 이 주소로 보내진 비트코인은 개인키를 가지고 있는 사람만 다른 주소로 보낼 수가 있는 것입니다. (개인키로 주소를 만들 수도 있는데, 개인키를 넘겨 주는 것은 해당 공개 주소에 속한 비트코인의 사용권을 넘겨 주는 것과 같습니다. 일정량의 비트코인을 보내 놓고 개인키를 QR코드로 인쇄해서 상품권처럼 팔기도 합니다.)

만약 어떤 이유로 개인키가 소실된다면 해당 주소의 비트코인은 영원히 사용할 수 없게 됩니다. 때문에 백업된 이후에 추가된 주소로 보내진 비트코인은 개인키가 소실되면 이전의 백업을 복구해도 사용할 수 없게 됩니다. (주소를 추가하면 백업을 다시 해야 한다는 뜻입니다.)

<!-- sha256 내용 -->

### 블록 체인(Block chain)

비트코인 네트워크상의 모든 거래(transaction)는 [블록(Block)][wiki-block]들이라 불리는 파일에 저장됩니다.
한 블록은 이전 블록에 기록되지 않은 최근의 거래기록들을 담게 됩니다. 몇몇 예외적인 경우를 제외하고 한 블록은 이전 거래기록의 끝에 이어지게 됩니다. (이렇게 이어진 블록들을 불록 체인이라고 부릅니다.)
블록이 한 번 쓰여지게 되면 제거되거나 변하지 않습니다.

그런데, 이 블록이 블록 체인에 공식적으로 포함되는 것이 쉬운 일이 아닙니다. 블록 체인에 포함되기 위해서는 특정한 조건을 만족해야만 하는데, 이것은 분산 네트워크 상에서 이중 거래(Double spending) 등이 불가능하도록 해주는 안정장치 같은 것입니다. 이 조건을 만족하면 블록이 인정(confirm)되었다고 하는 것입니다. 조금 더 구체적으로 이 조건은 블록 헤더의 해시 결과가 타겟(Target) 숫자 이하일 경우를 말합니다. (비트코인은 SHA256^2를 사용합니다.)

* [암호화 해시 함수][crypto-hash]
* [Hashcash - SHA256^2][wiki-hashcash]

이 타겟을 결정하는 것이 ["난이도(difficulty)"][wiki-dificulty] 입니다. 이전 글에서도 이야기한 바와 같이 이 난이도는 전 세계 채굴자들이 열심히 채굴을 했을 때 10분 정도 걸리도록 2016 블록마다 조정됩니다.

<!-- 예를 들어 -->

이렇게 블록의 인정이 쉽지 않기 때문에 이미 인정된 거래를 뒤집는 것은 실질적으로 불가능한 일이 됩니다. (공식적으로 6번의 인정을 받아야 온전히 인정된 거래로 여겨집니다.) 비트코인 네트워크 참여자들이 (난이도를 기준으로) 가장 긴 블록 체인을 최종 체인으로 여기게 되어있기 때문입니다. 

### 채굴(Mining)

[블록 헤더][wiki-block-hashing]에는 의미 없는 값이 들어가는 32비트의 Nonce 필드가 있어서 채굴자들은 이 값을 바꿔 가면서 헤더의 해시 값을 계산해보게 됩니다. 그러다가 해시 값이 타겟보다 작은 Nonce 를 발견하게 되면 블록이 인정되고 보상을 받게 되는 것이죠.
32비트만으로 만들 수 있는 구별된 헤더의 가지 수는 얼마 안되지만 블록 바디에 추가로 ExtraNonce 필드(2~100바이트 가변 길이)가 있습니다. 블록 헤더에는 바디의 해시 필드가 있기 때문에 같은 거래 기록을 가지고 채굴자들은 충분히 많은(2<sup>832</sup>) 종류의 블록 헤더를 만들어 낼 수 있습니다.

이와 더불어 블록의 첫번째 거래는 생성(Generation) 거래, 즉 보상을 채굴자에게 주는 거래이기 때문에 보상을 받을 주소를 포함합니다. 모든 채굴자(혹은 마이닝풀)들은 각각 다른 블록으로 채굴을 하게 됩니다. 이렇지 않으면 같은 Nonce 와 ExtraNonce 값에서부터 채굴을 시작했을 때 항상 해싱 파워를 더 많이 가지고 있는 채굴자가 보상을 받습니다. 랜덤하게 시작한다고 하더라도 여전히 해싱 파워가 높은 쪽이 보상을 받을 확률이 해싱 파워의 비율보다 큽니다. 이에 반하여 각각 다른 블록에서 시작하면 보상 받을 확률과 해싱 파워의 비율은 일치합니다.

이론적으로는 전세계 해싱 파워(Hashing power)의 50%를 초과하는 해싱 파워를 가지고 있다면 이중 거래 공격이 가능할 수 있지만, 실제로는 그런 능력을 가지기도 어렵고, 능력이 되더라도 전체 비트코인 시스템자체를 끝장내는 일이 되기 때문에 그다지 구미가 당길 일은 아닙니다. 하지만, 그런 능력이 있는 마이닝 풀이나 단체가 있다면, 파괴 자체를 목적으로 마이닝 풀을 해킹한다거나 할 수도 있겠다는 생각은 드네요. 비트코인 마이너들은 그런 마이닝 풀이 생기는 것을 극도로 싫어하거나 두려워합니다. GHash.io의 마이닝 파워가 50% 넘어갈 기미가 보이자 인터넷 상으로 마이닝 풀을 옮기라고 시끌시끌한 일도 있었습니다.
